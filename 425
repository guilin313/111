import os
import tifffile
import numpy as np
from PIL import Image

# 指定四个.tif文件的路径
tif_paths = [
    '/path/to/file1.tif',
    '/path/to/file2.tif',
    '/path/to/file3.tif',
    '/path/to/file4.tif',
]

images = []
for path in tif_paths:
    img_stack = tifffile.imread(path)
    first_slice = img_stack[0] if img_stack.ndim == 3 else img_stack
    images.append(first_slice)

# 确保图像大小统一（可选 resize）
height = max(img.shape[0] for img in images)
widths = [img.shape[1] for img in images]
total_width = sum(widths)

# 转换为PIL图像（灰度）
pil_images = [Image.fromarray(img).convert("L") for img in images]

# 拼接图像
result = Image.new('L', (total_width, height))
x_offset = 0
for img in pil_images:
    result.paste(img, (x_offset, 0))
    x_offset += img.width

# 创建保存目录
output_dir = os.path.join(os.getcwd(), 'concat')
os.makedirs(output_dir, exist_ok=True)

# 保存图像
output_path = os.path.join(output_dir, 'concat_output.tif')
result.save(output_path)

print(f"保存成功：{output_path}")
